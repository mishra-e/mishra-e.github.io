// filename: TimezoneConverter.jsx
// Timezone Converter Webapp with searchable dropdown and pretty labels
// Dependencies: npm install moment-timezone react-select countries-and-timezones

import React, { useState } from 'react';
import moment from 'moment-timezone';
import Select from 'react-select';
import ct from 'countries-and-timezones';

// Build options: label = "City, Country", value = IANA timezone
const timezoneOptions = moment.tz.names().map((tz) => {
  const parts = tz.split('/');
  const city = parts[parts.length - 1].replace(/_/g, ' ');
  const info = ct.getTimezone(tz);
  const countryCode = info?.countries?.[0];
  const country = countryCode ? ct.getCountry(countryCode).name : parts[0];
  return { value: tz, label: `${city}, ${country}` };
});

export default function TimezoneConverter() {
  const defaultHome = timezoneOptions.find((o) => o.value === 'America/New_York');
  const [homeTz, setHomeTz] = useState(defaultHome);
  const [cities, setCities] = useState([]);
  const [offset, setOffset] = useState(0);
  const hours = Array.from({ length: 24 }, (_, i) => i);

  const handleCities = (selected) => setCities(selected || []);

  return (
    <div className="p-4 max-w-4xl mx-auto">
      <h1 className="text-2xl font-bold mb-6">Timezone Converter</h1>

      <div className="mb-4">
        <label htmlFor="home-tz-select" className="block mb-1 font-medium">
          Home Timezone:
        </label>
        <Select
          inputId="home-tz-select"
          options={timezoneOptions}
          value={homeTz}
          onChange={setHomeTz}
          isSearchable
          placeholder="Select your home timezone..."
        />
      </div>

      <div className="mb-4">
        <label htmlFor="cities-select" className="block mb-1 font-medium">
          Compare with:
        </label>
        <Select
          inputId="cities-select"
          options={timezoneOptions}
          value={cities}
          onChange={handleCities}
          isSearchable
          isMulti
          placeholder="Select one or more timezones..."
        />
      </div>

      <div className="mb-6">
        <label className="block mb-1 font-medium">
          Time Offset (hours): <span>{offset}</span>
        </label>
        <input
          type="range"
          min="-12"
          max="12"
          value={offset}
          onChange={(e) => setOffset(Number(e.target.value))}
          className="w-full"
        />
      </div>

      <div className="overflow-x-auto">
        <table className="min-w-full border-collapse">
          <thead>
            <tr>
              <th className="border p-2 text-left">Hour ({homeTz.label})</th>
              {cities.map((o) => (
                <th key={o.value} className="border p-2 text-left">
                  {o.label}
                </th>
              ))}
            </tr>
          </thead>
          <tbody>
            {hours.map((h) => {
              const base = moment().tz(homeTz.value).startOf('day');
              const time = base.clone().add(h + offset, 'hours');
              return (
                <tr key={h}>
                  <td className="border p-2">{time.format('HH:mm')}</td>
                  {cities.map((o) => (
                    <td key={o.value} className="border p-2">
                      {time.clone().tz(o.value).format('HH:mm')}
                    </td>
                  ))}
                </tr>
              );
            })}
          </tbody>
        </table>
      </div>
    </div>
  );
}
