<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Timezone Tool</title>

  <!-- Tailwind (keep if you still want utility classes inside React) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Your custom site‐wide styles -->
  <link rel="stylesheet" href="styles.css">

  <!-- React & ReactDOM (for JSX/Babel) -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>

  <!-- Babel -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Moment + Timezone -->
  <script src="https://unpkg.com/moment/min/moment.min.js"></script>
  <script src="https://unpkg.com/moment-timezone/builds/moment-timezone-with-data.min.js"></script>
</head>
<body>
  <!-- HEADER -->
  <header>
    <div class="container">
      <h1><a href="index.html">Ekta Mishra</a></h1>
      <nav>
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="timezone.html">Timezone Tool</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- MAIN APP WRAPPER -->
  <main class="section">
    <div class="container">
      <div id="root"></div>
    </div>
  </main>

  <!-- FOOTER -->
  <footer class="site-footer">
    <div class="footer-container">
      <div class="footer-column">
        <p><strong>Email</strong><br>
        <a href="mailto:emishra9624@gmail.com">emishra9624@gmail.com</a></p>
      </div>
      <div class="footer-column">
        <p><strong>Location</strong><br>
        New Haven, US</p>
      </div>
      <div class="footer-column">
        <p><strong>Social</strong><br>
        <a href="https://twitter.com/">Twitter</a></p>
      </div>
    </div>
    <div class="footer-bottom">
      &copy; 2025 Ekta Mishra
    </div>
  </footer>

  <!-- YOUR REACT APP (unchanged) -->
  <script type="text/babel">
    const { useState } = React;

    const timezoneOptions = moment.tz.names().map(tz => {
      const parts = tz.split('/');
      const city = parts.pop().replace(/_/g, ' ');
      const region = parts.join(' / ').replace(/_/g, ' ');
      return { value: tz, label: `${city}, ${region}` };
    });

    function TimezoneGraph() {
      const defaultHome = timezoneOptions.find(o => o.value === 'America/New_York');
      const [homeTz, setHomeTz] = useState(defaultHome);
      const [destinations, setDestinations] = useState([null]);
      const [homeWorkHours, setHomeWorkHours] = useState({ start: 8, end: 19 });
      const [destWorkHours, setDestWorkHours] = useState(destinations.map(() => ({ start: 8, end: 19 })));

      const updateDestination = (opt, idx) => {
        const next = [...destinations];
        next[idx] = opt;
        setDestinations(next);
        const nextWork = [...destWorkHours];
        while (nextWork.length < next.length) nextWork.push({ start: 8, end: 19 });
        setDestWorkHours(nextWork);
      };

      const addDestination = () => {
        setDestinations([...destinations, null]);
        setDestWorkHours([...destWorkHours, { start: 8, end: 19 }]);
      };

      const removeDestination = idx => {
        setDestinations(destinations.filter((_, i) => i !== idx));
        setDestWorkHours(destWorkHours.filter((_, i) => i !== idx));
      };

      const updateDestWorkHours = (idx, field, value) => {
        const next = [...destWorkHours];
        next[idx] = { ...next[idx], [field]: parseInt(value) };
        setDestWorkHours(next);
      };

      const hours = Array.from({ length: 24 }, (_, i) => i);
      const base = moment().tz(homeTz.value).startOf('day');

      const isWorkHour = (time, work) => {
        const h = parseInt(time.format('H'));
        return h >= work.start && h <= work.end;
      };

      const getGMTOffset = tz => {
        const offset = moment.tz(tz).utcOffset();
        const sign = offset >= 0 ? '+' : '-';
        const abs = Math.abs(offset);
        const hrs = Math.floor(abs / 60);
        const mins = abs % 60;
        return `GMT${sign}${hrs}${mins ? ':' + String(mins).padStart(2, '0') : ''}`;
      };

      const exportToCSV = () => {
        let csv = ['Hour,' + homeTz.label];
        destinations.forEach(d => d && (csv[0] += ',' + d.label));
        csv.push('GMT Offset,' + getGMTOffset(homeTz.value) + ',' +
          destinations.filter(d => d).map(d => getGMTOffset(d.value)).join(','));
        hours.forEach(h => {
          const row = base.clone().add(h, 'hours');
          let line = `${h}:00,${row.format('HH:mm')}`;
          destinations.forEach(d => {
            if (d) {
              const dt = row.clone().tz(d.value);
              line += ',' + dt.format('HH:mm');
            }
          });
          csv.push(line);
        });
        const uri = encodeURI("data:text/csv;charset=utf-8," + csv.join('\n'));
        const link = document.createElement('a');
        link.setAttribute('href', uri);
        link.setAttribute('download', 'timezone_comparison.csv');
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      };

      return (
        <div>
          <h2>Timezone Comparison Grid</h2>

          <div>
            <label>Home Timezone:</label>
            <select
              value={homeTz.value}
              onChange={e => setHomeTz(timezoneOptions.find(o => o.value === e.target.value))}
            >
              {timezoneOptions.map(opt => (
                <option key={opt.value} value={opt.value}>{opt.label}</option>
              ))}
            </select>
            <span> Highlight Hours: </span>
            <select
              value={homeWorkHours.start}
              onChange={e => setHomeWorkHours({ ...homeWorkHours, start: parseInt(e.target.value) })}
            >
              {hours.map(h => <option key={h} value={h}>{h}:00</option>)}
            </select>
            <span> to </span>
            <select
              value={homeWorkHours.end}
              onChange={e => setHomeWorkHours({ ...homeWorkHours, end: parseInt(e.target.value) })}
            >
              {hours.map(h => <option key={h} value={h}>{h}:00</option>)}
            </select>
          </div>

          {destinations.map((dest, i) => (
            <div key={i}>
              <label>Destination {i + 1}:</label>
              <select
                value={dest?.value || ''}
                onChange={e => updateDestination(timezoneOptions.find(o => o.value === e.target.value), i)}
              >
                <option value="">Select…</option>
                {timezoneOptions.map(opt => (
                  <option key={opt.value} value={opt.value}>{opt.label}</option>
                ))}
              </select>

              {dest && (
                <>
                  <span> Highlight Hours: </span>
                  <select
                    value={destWorkHours[i].start}
                    onChange={e => updateDestWorkHours(i, 'start', e.target.value)}
                  >
                    {hours.map(h => <option key={h} value={h}>{h}:00</option>)}
                  </select>
                  <span> to </span>
                  <select
                    value={destWorkHours[i].end}
                    onChange={e => updateDestWorkHours(i, 'end', e.target.value)}
                  >
                    {hours.map(h => <option key={h} value={h}>{h}:00</option>)}
                  </select>
                </>
              )}

              <button onClick={() => removeDestination(i)}>Remove</button>
            </div>
          ))}

          <div>
            <button onClick={addDestination}>+ Add Destination</button>
            <button onClick={exportToCSV}>Export to CSV</button>
          </div>

          <table>
            <thead>
              <tr>
                <th>Hour</th>
                <th>{homeTz.label}</th>
                {destinations.map((d, i) => d && <th key={i}>{d.label}</th>)}
              </tr>
              <tr>
                <th>GMT Offset</th>
                <th>{getGMTOffset(homeTz.value)}</th>
                {destinations.map((d, i) => d && <th key={i}>{getGMTOffset(d.value)}</th>)}
              </tr>
            </thead>
            <tbody>
              {hours.map(h => {
                const row = base.clone().add(h, 'hours');
                return (
                  <tr key={h}>
                    <td>{h}:00</td>
                    <td className={isWorkHour(row, homeWorkHours) ? 'highlight' : ''}>
                      {row.format('HH:mm')}
                    </td>
                    {destinations.map((d, i) => {
                      if (!d) return null;
                      const dt = row.clone().tz(d.value);
                      return (
                        <td key={i} className={isWorkHour(dt, destWorkHours[i]) ? 'highlight' : ''}>
                          {dt.format('HH:mm')}
                        </td>
                      );
                    })}
                  </tr>
                );
              })}
            </tbody>
          </table>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<TimezoneGraph />);
  </script>
</body>
</html>
