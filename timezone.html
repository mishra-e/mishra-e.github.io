// filename: TimezoneConverter.jsx
// Timezone Converter Webapp with dynamic home and destination columns and hover highlighting
// Dependencies: npm install moment-timezone react-select countries-and-timezones

import React, { useState } from 'react';
import moment from 'moment-timezone';
import Select from 'react-select';
import ct from 'countries-and-timezones';

// Prepare dropdown options: "City, Country"
const timezoneOptions = moment.tz.names().map((tz) => {
  const parts = tz.split('/');
  const city = parts[parts.length - 1].replace(/_/g, ' ');
  const info = ct.getTimezone(tz);
  const countryCode = info?.countries?.[0];
  const country = countryCode ? ct.getCountry(countryCode).name : parts[0];
  return { value: tz, label: `${city}, ${country}` };
});

export default function TimezoneConverter() {
  const defaultHome = timezoneOptions.find((o) => o.value === 'America/New_York');
  const [homeTz, setHomeTz] = useState(defaultHome);
  // Start with one destination slot (null until selected)
  const [destinations, setDestinations] = useState([null]);
  const [offset, setOffset] = useState(0);
  const hours = Array.from({ length: 24 }, (_, i) => i);

  const updateDestination = (selected, idx) => {
    setDestinations((prev) => {
      const next = [...prev];
      next[idx] = selected;
      return next;
    });
  };

  const addDestination = () => setDestinations((prev) => [...prev, null]);

  return (
    <div className="p-6 max-w-4xl mx-auto space-y-6 bg-white shadow-xl rounded-lg">
      <h1 className="text-3xl font-bold text-blue-700 text-center">Timezone Converter</h1>

      {/* Home timezone select */}
      <div>
        <label htmlFor="home-select" className="block mb-2 font-semibold">
          Home Timezone:
        </label>
        <Select
          inputId="home-select"
          options={timezoneOptions}
          value={homeTz}
          onChange={setHomeTz}
          isSearchable
          placeholder="Select home timezone..."
        />
      </div>

      {/* Destination timezone selects */}
      <div className="space-y-4">
        {destinations.map((dest, i) => (
          <div key={i}>
            <label htmlFor={`dest-select-${i}`} className="block mb-2 font-semibold">
              Destination {i + 1}:
            </label>
            <Select
              inputId={`dest-select-${i}`}
              options={timezoneOptions}
              value={dest}
              onChange={(opt) => updateDestination(opt, i)}
              isSearchable
              placeholder="Select destination timezone..."
            />
          </div>
        ))}
        <button
          type="button"
          onClick={addDestination}
          className="mt-2 px-5 py-2 bg-green-500 hover:bg-green-600 text-white font-medium rounded-lg shadow"
        >
          + Add Destination
        </button>
      </div>

      {/* Offset slider */}
      <div>
        <label className="block mb-2 font-semibold">
          Time Offset (hours): <span className="text-blue-600 font-bold">{offset}</span>
        </label>
        <input
          type="range"
          min="-12"
          max="12"
          value={offset}
          onChange={(e) => setOffset(Number(e.target.value))}
          className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer hover:bg-gray-300"
        />
      </div>

      {/* Time table */}
      <div className="overflow-x-auto">
        <table className="min-w-full border-collapse table-auto">
          <thead className="bg-blue-600 text-white">
            <tr>
              <th className="border px-4 py-2 text-left">Hour ({homeTz.label})</th>
              {destinations.map(
                (d, idx) =>
                  d && (
                    <th key={idx} className="border px-4 py-2 text-left">
                      {d.label}
                    </th>
                  )
              )}
            </tr>
          </thead>
          <tbody>
            {hours.map((h) => {
              const base = moment().tz(homeTz.value).startOf('day');
              const time = base.clone().add(h + offset, 'hours');
              return (
                <tr key={h} className="hover:bg-blue-100 even:bg-gray-50">
                  <td className="border px-4 py-2">{time.format('HH:mm')}</td>
                  {destinations.map(
                    (d, idx) =>
                      d && (
                        <td key={idx} className="border px-4 py-2">
                          {time.clone().tz(d.value).format('HH:mm')}
                        </td>
                      )
                  )}
                </tr>
              );
            })}
          </tbody>
        </table>
      </div>
    </div>
  );
}
